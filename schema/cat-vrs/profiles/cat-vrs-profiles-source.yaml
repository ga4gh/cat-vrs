$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://w3id.org/ga4gh/schema/cat-vrs/1.x/profiles/cat-vrs-profiles-source.yaml"
title: GA4GH-Cat-VRS-Definitions
type: object
strict: true

imports:
  gks.core-im: ../../core-im/core-im-source.yaml
  gks.data-types: ../../data-types/data-types-source.yaml
  vrs: ../../vrs/vrs-source.yaml
  cat.core: ../core/cat-vrs-core-source.yaml

$defs:
  ProteinSequenceConsequenceProperties:
    properties:
      constraints:
        contains:
          allOf:
            - $ref: "/ga4gh/schema/cat-vrs/1.x/core/json/DefiningContextConstraint"
            - type: object
              properties:
                relations:
                  contains:
                    const: codon_translation

  ProteinSequenceConsequence:
    type: object
    maturity: draft
    description: >-
      A change that occurs in a protein sequence as a result of genomic changes. Due to the degenerate nature
      of the genetic code, there are often several genomic changes that can cause a protein sequence consequence.
      The protein sequence consequence, like a :ref:`CanonicalAllele`, is defined by an
      `Allele <https://vrs.ga4gh.org/en/2.x/concepts/MolecularVariation/Allele.html#>`
      that is representative of a collection of congruent Protein Alleles that share the same altered codon(s).
    allOf:
      - $ref: "#/$defs/ProteinSequenceConsequenceProperties"
      - $ref: "/ga4gh/schema/cat-vrs/1.x/core/json/CategoricalVariation"

  CanonicalAlleleProperties:
    properties:
      constraints:
        contains:
          allOf:
            - $ref: "/ga4gh/schema/cat-vrs/1.x/core/json/DefiningContextConstraint"
            - type: object
              properties:
                relations:
                  allOf:
                    - contains:
                        const: sequence_liftover
                    - contains:
                        const: transcript_projection

  CanonicalAllele:
    maturity: draft
    description: >-
      A canonical allele is defined by an `Allele <https://vrs.ga4gh.org/en/2.x/concepts/MolecularVariation/Allele.html#>`_
      that is representative of a collection of congruent Alleles, each of which depict the same nucleic acid
      change on different underlying reference sequences. Congruent representations of an Allele often exist
      across different genome assemblies and associated cDNA transcript representations.
    type: object
    allOf:
      - $ref: "#/$defs/CanonicalAlleleProperties"
      - $ref: "/ga4gh/schema/cat-vrs/1.x/core/json/CategoricalVariation"


  # CategoricalCnv:
  #   type: object
  #   inherits: CategoricalVariation
  #   maturity: draft
  #   description: >-
  #     A categorical variation domain is defined first by a sequence derived from a canonical `SequenceLocation
  #     <https://vrs.ga4gh.org/en/2.x/concepts/LocationAndReference/SequenceLocation.html>`_ ,
  #     which is representative of a collection of congruent Locations. The change or count of this sequence is
  #     also described, either by a numeric value (e.g. "3 or more copies") or categorical representation
  #     (e.g. "high-level gain"). Categorical CNVs may optionally be defined by rules specifying the location
  #     match characteristics for member CNVs.
  #   properties:
  #     type:
  #       extends: type
  #       const: CategoricalCnv
  #       default: CategoricalCnv
  #       description: 'MUST be "CategoricalCnv"'
  #     location:
  #       oneOf:
  #         - $ref: "/ga4gh/schema/vrs/2.x/json/SequenceLocation"
  #         - $ref: "/ga4gh/schema/gks-common/1.x/data-types/json/IRI"
  #       description: >-
  #         A `SequenceLocation <https://vrs.ga4gh.org/en/2.x/concepts/LocationAndReference/SequenceLocation.html>`_
  #         object that represents a sequence derived from that location, and is congruent with locations
  #         on alternate reference sequences.
  #     locationMatchCharacteristic:
  #       type: string
  #       enum: ['exact', 'partial', 'subinterval', 'superinterval']
  #       description: >-
  #         The characteristics of a valid match between a contextual CNV location (the query) and the
  #         Categorical CNV location (the domain), when both query and domain are represented on the same
  #         reference sequence. An `exact` match requires the location of the query and domain to be identical.
  #         A `subinterval` match requires the query to be a subinterval of the domain. A `superinterval` match
  #         requires the query to be a superinterval of the domain. A `partial` match requires at least 1 residue
  #         of overlap between the query and domain.
  #     copyChange:
  #       type: string
  #       enum: [ "EFO:0030069", "EFO:0020073", "EFO:0030068", "EFO:0030067", "EFO:0030064", "EFO:0030070", "EFO:0030071", "EFO:0030072" ]
  #       description: >-
  #         A representation of the change in copies of a sequence in a system. MUST be one of "EFO:0030069" (complete
  #         genomic loss), "EFO:0020073" (high-level loss), "EFO:0030068" (low-level loss), "EFO:0030067" (loss),
  #         "EFO:0030064" (regional base ploidy), "EFO:0030070" (gain), "EFO:0030071" (low-level gain), "EFO:0030072"
  #         (high-level gain).
  #     copies:
  #       oneOf:
  #         - type: integer
  #         - $ref: "/ga4gh/schema/vrs/2.x/json/Range"
  #       description: >-
  #         The integral number of copies of the subject in a system.
  #   required:
  #     - location

  # DescribedVariation:
  #   type: object
  #   inherits: CategoricalVariation
  #   maturity: draft
  #   description: >-
  #     Some categorical variation concepts are supported by custom nomenclatures or text-descriptive
  #     representations for which a categorical variation model does not exist. DescribedVariation is
  #     a class that adds requirements and contextual semantics to the `label` and `description` fields
  #     to indicate how a categorical variation concept should be evaluated for matching variants.
  #   properties:
  #     type:
  #       extends: type
  #       const: DescribedVariation
  #       default: DescribedVariation
  #       description: 'MUST be "DescribedVariation"'
  #     label:
  #       extends: label
  #       description: >-
  #         A primary label for the categorical variation. This required property should provide a
  #         short and descriptive textual representation of the concept.
  #     description:
  #       extends: description
  #       description: >-
  #         A textual description of the domain of variation that should match the categorical
  #         variation entity.
  #   required:
  #     - label
  #   NumberCount:
  #   # ga4ghDigest:
  #   #   keys:
  #   #     - numberCount
  #   type: object
  #   # inherits: QuantityVariance
  #   maturity: draft
  #   description: >-
  #     The absolute count of a discrete assayable unit (e.g. chromosome, gene, or sequence).
  #   properties:
  #     type:
  #       type: string
  #       const: "NumberCount"
  #       default: "NumberCount"
  #       description: >-
  #         MUST be "NumberCount"
  #     count:
  #       oneOf:
  #         - type: integer
  #         - $ref: "/ga4gh/schema/vrs/2.x/json/Range"
  #       description: >-
  #         The integral quantity or quantity range of the subject in a system
  #   required: [ "count" ]
  # NumberChange:
  #   # ga4ghDigest:
  #   #   keys:
  #   #     - numberChange
  #   #   prefix: CX
  #   type: object
  #   maturity: draft
  #   description: >-
  #     A quantitative assessment of a unit within a system (e.g. genome, cell,
  #     etc.) relative to a baseline quantity.
  #   properties:
  #     type:
  #       type: string
  #       const: "NumberChange"
  #       default: "NumberChange"
  #       description: >-
  #         MUST be "NumberChange"
  #     change:
  #       oneOf:
  #         - type: integer
  #         - $ref: "/ga4gh/schema/vrs/2.x/json/Range"
  #         - copyChange:
  #           type: string
  #           enum: [ "EFO:0030069", "EFO:0020073", "EFO:0030068", "EFO:0030067", "EFO:0030064", "EFO:0030070",
  #                   "EFO:0030071", "EFO:0030072" ]
  #       description: >-
  #         a quantitative or qualitative value of the measurement with respect to a baseline (0). 
  #         If qualitative, must be one of "EFO:0030069" (complete genomic loss), "EFO:0020073" (high-level loss),
  #         "EFO:0030068" (low-level loss), "EFO:0030067" (loss), "EFO:0030064" (regional base ploidy),
  #         "EFO:0030070" (gain), "EFO:0030071" (low-level gain), "EFO:0030072" (high-level gain).
  #       required: [ "change" ]
  # QuantityVariance:
    type: object
    # inherits: NumberCount
    maturity: draft
    description: >-
      The Quantity Variance class captures one axis of variation in the generalized model of categorical
      variation.  It is used to model quantitative measure changes in a given biological level of
      variation.
    properties:
      type:
        type: string
        const: QuantityVariance
        default: QuantityVariance
        description: 'MUST be "QuantityVariance"'